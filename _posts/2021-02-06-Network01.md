---
layout: post
title: (네트워크) DNS
tags:
  - 네트워크
---

<br>

## DNS(domain name system)

<br>

### DNS는 ...

- 호스트가 분산 데이터베이스로 질의하도록 허락하는 `애플리케이션 계층 프로토콜`이다 

- DNS 프로토콜은 `UDP`상에서 수행되고 `포트번호 53`을 이용한다

- DNS서버들은 `계층구조`로 구현된 `분산 데이터베이`스이다

<br>

### DNS가 제공하는 서비스

- `hostname`을 `IP address`로 변환해주는 서비스이다

  - 웹 브라우저에서 주소창에 www.google.com을 검색했을 때 어떤 일이 일어나는지 대략적으로 생각해보자

    ```
    1. 사용자 컴퓨터는 DNS 애플리케이션의 클라이언트 측을 수행한다
    2. 브라우저는 URL로부터 호스트네임 www.google.com을 추출하고, 그 호스트네임을 DNS 애플리케이션의 클라이언트 측에 넘긴다
    3. DNS 클라이언트는 DNS서버로 호스트 네임을 포함하는 질의를 보낸다
    ...
    4. DNS 클라이언트는 결국 호스트네임에 대한 IP주소 응답을 받게 된다
    5. 브라우저가 DNS로부터 IP주소를 받으면, 브라우저는 그 IP 주소와 그 주소의 80번 포트에 위치하는 HTTP서버 프로세스로 TCP연결을 초기화한다
    ```

- ​	그 외에도 다음과 같은 서비스를 제공한다

  - 호스트 엘리어싱 
    - 복잡한 호스트네임을 가진 호스트는 하나 이상의 별명을 가진다
    - DNS는 별칭 호스트네임에 대한 정식 호스트네임을 얻기 위해 이용될 수 있다
  - 메일 서버 엘리어싱
    - 위와 마찬가지로 메일서버는 별명을 가지고 있고, 이에 대한 정식 호스트네임을 얻을 수 있다
  - 부하 분산 (load distribution)
    - 여러 중복 서버 사이에 부하를 분산하기 위해서 사용되기도 한다
    - 인기 있는 사이트는 여러 서버에 중복되어 있어서, 각 서버가 다른 IP주소를 가진 다른 종단 시스템에서 수행된다
    - 이때 여러 IP주소가 하나의 정식 호스트 네임과 매핑되어 있다
    - DNS는 이 IP주소 집합을 가지고, 호스트네임에 대해 응답한다

<br>

### DNS의 동작 원리 - 분산계층 데이터 베이스

- 중앙 집중형 단일 DNS서버의 문제점
  - 서버 고장시에는? 트래픽 양의 집중, 먼 거리의 트래픽일 경우 매운 느린 응답, 수많은 레코드 유지/관리의 어려움
- 확장성 문제를 다루기 위해 DNS서버를 `계층 형태`로 구성하여 `전 세계에 분산`시킨다
  - `Root DNS Server`
  - `TLD(Top-Level Domain) DNS Server`
    - TLD서버들은 책임 DNS 서버들의 대한 IP주소를 제공한다
    - com, org, net, edu와 같은 상위 레벨 도메인
    - kr,uk,fr,ca,jp과 같은 국가별 상위 레벨 도메인
  - `Authoritative DNS Server`
    - 인터넷에서 접근하기 쉬운 호스트 (예를 들어 웹서버와 메일서버)를 가진 기관은 호스트네임을 IP주소로 매핑하는 공개적인 DNS 레코드를 제공해야 한다
    - 기관의 책임 DNS 서버는 이 DNS 레코드를 가지고 있다
    - 기관은 이 레코드를 위해 자신의 책임 DNS 서버를 구현할 수도 있고, 일부 서비스 제공자의 책임 DNS 서버에 이 레코드를 저장하도록 비용을 지불하기도 한다
    - 대부분 대학과 큰 기업들은 자신의 기본 책임 DNS 서버와 보조 책임 DNS 서버를 구현하고 유지한다 
  - `Local DNS Server`
    - 위에서 언급한 DNS 3계층에는 속하지 않지만 중요한 역할을 담당한다
    - 대학 또는 주거지역 ISP들은 로컬 DNS 서버를 갖는다 
    - `호스트가 DNS질의를 보내면, 이 질의는 먼저 프록시로 동작하는 로컬 DNS 서버에게 전달되고, 그 로컬 DNS 서버는 이 질의를 DNS 서버 계층으로 전달한다`

<br>

### DNS의 동작 원리 - DNS 캐싱

- 로컬 DNS 서버는 임의의 DNS 서버에서 응답을 받을 때마다 정보를 저장한다
- 이후 다른 호스트로부터 같은 질의가 도착하면 로컬 DNS 서버는 호스트네임에 대한 책임이 없어도 원하는 IP를 제공할 수 있게 됨

<br>

### DNS 레코드와 메시지

- DNS 서버들은 호스트네임을 IP주소로 매핑하기 위해 `자원레코드(RR, resource record)`를 사용한다
- 각 DNS는 하나 이상의 자원 레코드를 가진 메시지로 응답한다
- 자원 레코드는 다음과 같은 필드를 포함하는 4개의 튜플로(`Name`, `Value`, `Type`, `TTL`) 되어 있다
  - `Type=A`
    - name => 호스트네임 / value => IP주소
  - `Type=NS`
    - name => 도메인 / value => 도메인 내부 호스트에 대한 IP주소를 얻을 수 있는 방법을 아는 책임 DNS서버의 호스트 네임
    - ex) `foo.com` / `dns.foo.com`
  - `Type=CNAME`
    - name => 별칭 호스트 네임 / value => 정식 호스트네임
  - `Type=MX`
    - name => 별칭 호스트 네임 / value => 정식 메일 서버 이름
    - ex) `foo.com` / `mail.bar.foo.com`

<br>

```
gaia.cs.umass.edu에 대한 질의를 Root DNS Server로 보냈을 때
(.edu, dns.edu, NS) 
(dns.edu, 2.2.2.2, A)

gaia.cs.umass.edu에 대한 질의를 TLD DNS Server로 보냈을 때
(umass.edu, dns.umass.edu, NS)
(dns.umass.edu, 5.5.5.5, A)

- 2개의 레코드를 한쌍으로 
```

<br>